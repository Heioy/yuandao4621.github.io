### ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Ÿ

åœ¨ ç±»Unixæ“ä½œç³»ç»Ÿ ä¸Šï¼Œæ™®éå°†æ“ä½œç³»ç»Ÿä¸Šçš„èµ„æºæŠ½è±¡æˆæ–‡ä»¶è¿™ä¸€æ¦‚å¿µï¼Œè¯¸å¦‚ç¡¬ä»¶è®¾å¤‡ã€æ™®é€šæ–‡ä»¶ã€scoketå¥—æŽ¥å­—ã€å¯ç§»åŠ¨å­˜å‚¨ç­‰ä»‹è´¨éƒ½è¢«æŠ½è±¡ä¸ºæ–‡ä»¶ã€‚é‚£ä¹ˆï¼Œã€Œæ–‡ä»¶æè¿°ç¬¦ã€ å’Œ ã€Œæ–‡ä»¶ã€ ä¹‹å‰æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæ¥çœ‹çœ‹ ã€Œæ–‡ä»¶æè¿°ç¬¦ã€æ˜¯æ€Žä¹ˆå‡ºçŽ°çš„ï¼Ÿ

åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œå½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹æ“ä½œç³»ç»Ÿèµ„æºæ—¶ï¼Œé¦–å…ˆä¼šè§¦å‘æ–‡ä»¶è°ƒç”¨äº‹ä»¶ï¼Œé€šè¿‡åº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹å‘é€ä¸€ä¸ªè°ƒç”¨æ–‡ä»¶çš„ä¿¡å·ç»™æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå†…æ ¸ä¼šåœ¨ `æ‰“å¼€æ–‡ä»¶è¡¨` ä¸­å¢žåŠ ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶å°† æ‰“å¼€æ–‡ä»¶è¡¨ä¸­æ–°å¢žçš„è®°å½• è¿”å›žç»™åº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹ï¼Œè€Œåº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹æŽ¥æ”¶åˆ°æ¥è‡ªå†…æ ¸è¿”å›žçš„ä¿¡æ¯ï¼Œç§°ä¸º `æ–‡ä»¶æè¿°ç¬¦(file desrciption)`ã€‚

å®žé™…ä¸Šï¼Œé€šè¿‡ å†…æ ¸ è¿”å›žçš„æ–‡ä»¶æè¿°ç¬¦æ­£æ˜¯ `æ‰“å¼€æ–‡ä»¶è¡¨` ä¸­è¯¥æ–‡ä»¶çš„ç´¢å¼•è®°å½•ï¼Œæ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚æ–‡ä»¶æè¿°ç¬¦ é€šå¸¸ä»Ž 3 å¼€å§‹è®°å½•ã€‚

åœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸‰ä¸ªæ ‡å‡†çš„ ã€ŒPOSIXã€æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¹åº”ä¸‰ä¸ªæ ‡å‡†æµï¼ŒæŒ‰ç…§ç´¢å¼•ä»¥ 0 å¼€å§‹ï¼Œåˆ†åˆ«æ˜¯ `Standard Input(æ ‡å‡†è¾“å…¥)`ã€`Standard Output(æ ‡å‡†è¾“å‡º)`ã€`Standard Error(æ ‡å‡†é”™è¯¯)`ã€‚

### æ–‡ä»¶æè¿°ç¬¦åœ¨æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨

æ–‡ä»¶æè¿°ç¬¦ æ˜¯æ“ä½œç³»ç»Ÿä¸Šéžå¸¸é‡è¦çš„èµ„æºï¼Œæ‰€æœ‰æ¶‰åŠåˆ° `I/O` çš„æ“ä½œéƒ½ä¸Ž æ–‡ä»¶æè¿°ç¬¦ç›¸å…³ã€‚ä½†æ“ä½œç³»ç»Ÿä¸Šè‡ªèº«çš„èµ„æºæœ¬å°±æœ‰é™ï¼Œå¯¹åº”çš„ æ–‡ä»¶æè¿°ç¬¦ è‡ªç„¶ä¸å¯èƒ½æ— ç©·æ— å°½ã€‚å› æ­¤ï¼Œäº†è§£å’Œè®¾ç½®æ“ä½œç³»ç»Ÿä¸­çš„ æ–‡ä»¶æè¿°ç¬¦ å¯¹äºŽç³»ç»Ÿå¥åº·æœ‰ç€ä¸å¯å¿½è§†çš„ä½œç”¨ã€‚

æŸ¥çœ‹æœ€å¤§å¯ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡

```bash
[root@server ~]# ulimit -n
65536
```

ä½ ä»¥ä¸º `ulimit -n` æŸ¥çœ‹åˆ°çš„æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€å¤§å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å—ï¼Ÿç­”æ¡ˆæ˜¯ä¸æ˜¯çš„ï¼Œ Linux æ“ä½œç³»ç»Ÿæ˜¯ å¤šç”¨æˆ·æ“ä½œç³»ç»Ÿï¼Œä¸ºäº†é¿å…ç³»ç»Ÿèµ„æºè¢«å•ä¸€ç”¨æˆ·è€—å°½ï¼Œç³»ç»Ÿåˆä¸ºæ¯ä¸ªç”¨æˆ·åšäº†é™åˆ¶ï¼Œé™åˆ¶æ¯ä¸ªç”¨æˆ·å¯ä»¥ä½¿ç”¨å¤šå°‘èµ„æºã€‚å¦å¤–ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜èµ„æºç›¸å…³(ä¸ºä»€ä¹ˆä¼šå’Œå†…å­˜æœ‰å…³å‘¢ï¼Œå› ä¸ºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¦æ¶ˆè€—å†…å­˜èµ„æºå‘¢ðŸ¤ª)ã€‚

é‚£ä¹ˆï¼Œä¸Šé¢çš„ `ulimit -n` ä½ çŽ°åœ¨å¯ä»¥çŸ¥é“äº†ï¼Œå¯¹äºŽ `root` ç”¨æˆ·æ¥è¯´ï¼Œæœ€å¤§å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯ 65536ã€‚ 

è‹¥è¦æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¸Šæœ€å¤§å¯ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œå¯é€šè¿‡ `sysctl -a` æŸ¥çœ‹

```bash
[root@server ~]# sysctl -a | grep -i file-max
fs.file-max = 6438631
```

ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦æ•°é‡

å½“æ“ä½œç³»ç»Ÿæœ¬èº«çš„å†…å­˜èµ„æºå¾ˆå°æˆ–è€…å†…å­˜è¶³å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦åŠ¨æ€è°ƒæ•´ç³»ç»Ÿåˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼Œå¯é€šè¿‡å‘½ä»¤è¿›è¡Œè°ƒæ•´ã€‚

(ç”¨æˆ·çº§)è°ƒæ•´å¯ä½¿ç”¨çš„æœ€å¤§æ•°é‡çš„æ–‡ä»¶æè¿°ç¬¦

```bash
[root@server ~]# ulimit -SHn 2048
[root@server ~]# ulimit -n
2048
```

è¯´æ˜Žï¼šé€šè¿‡ `ulimit` ä¿®æ”¹ä»…é’ˆå¯¹å½“å‰ç”¨æˆ·çš„å½“å‰ç»ˆç«¯ï¼Œå€˜è‹¥ä½¿ç”¨å¦ä¸€ç»ˆç«¯è¿›è¡Œç™»å½•ï¼Œä¼šå‘çŽ° fs è¿˜æ˜¯è®¾ç½®å‰çš„å€¼ã€‚é€€å‡ºå½“å‰ç»ˆç«¯åŽé‡æ–°å»ºç«‹ ssh è¿žæŽ¥ï¼Œç»“æžœä¸€æ ·ã€‚

(ç³»ç»Ÿçº§)è°ƒæ•´å¯ä½¿ç”¨çš„æœ€å¤§æ•°é‡çš„æ–‡ä»¶æè¿°ç¬¦

```bash
# ä¿®æ”¹ /etc/sysctl.conf æ–‡ä»¶ï¼Œå¢žåŠ ä¸€è¡Œé…ç½®
fs.file-max=97178
```

è¯´æ˜Žï¼šé€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹åŽï¼Œéœ€è¦ä½¿ç”¨ `sysctl -p` ä½¿å…¶ç”Ÿæ•ˆï¼›ä¿®æ”¹åŽçš„é…ç½®æ°¸ä¹…ç”Ÿæ•ˆã€‚

### æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦

æ“ä½œç³»ç»Ÿä¸­åº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹çš„è°ƒåº¦æ€»æ˜¯åœ¨å’Œæ–‡ä»¶æ‰“äº¤é“ï¼Œå¯¹äºŽä¸€ä¸ªæ´»åŠ¨ç€çš„è¿›ç¨‹ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡è¿›ç¨‹çœ‹åˆ°å¯¹åº”çš„ æ–‡ä»¶æè¿°ç¬¦ çš„ä¿¡æ¯ã€‚

ä»¥ oracle æ•°æ®åº“ä¸ºä¾‹ï¼ŒæŸ¥çœ‹ oracle ä¸­çš„ pmon è¿›ç¨‹æ‰“å¼€äº†å¤šå°‘æ–‡ä»¶æè¿°ç¬¦

æŸ¥è¯¢ pmon è¿›ç¨‹çš„è¿›ç¨‹id

```bash
[root@server ~]# ps -ef | grep ora_pmon
root      53876 123535  0 14:38 pts/0    00:00:00 grep --color=auto ora_pmon
oracle   253184      1  0 Nov03 ?        00:00:10 ora_pmon_rac2
```

å¯ä»¥çœ‹åˆ° oracle pmonè¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹idä¸º 253184

é€šè¿‡è¿›ç¨‹idæŸ¥çœ‹è¿›ç¨‹æœ€å¤§å¯è°ƒç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡

```bash
[root@server ~]# cat /proc/253184/limits
Limit                     Soft Limit           Hard Limit           Units
Max cpu time              unlimited            unlimited            seconds
Max file size             unlimited            unlimited            bytes
Max data size             unlimited            unlimited            bytes
Max stack size            33554432             33554432             bytes
Max core file size        unlimited            unlimited            bytes
Max resident set          unlimited            unlimited            bytes
Max processes             65536                65536                processes
Max open files            65536                65536                files
Max locked memory         unlimited            unlimited            bytes
Max address space         unlimited            unlimited            bytes
Max file locks            unlimited            unlimited            locks
Max pending signals       511917               511917               signals
Max msgqueue size         819200               819200               bytes
Max nice priority         0                    0
Max realtime priority     0                    0
Max realtime timeout      unlimited            unlimited            us
```

å¦‚ä¸Šç¬¬10è¡Œï¼Œ`Max open files` å³ä¸º oracle pmonè¿›ç¨‹å¯è°ƒåº¦çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œä¸º 65536 ä¸ªã€‚

æŸ¥çœ‹è¿›ç¨‹å·²ç»ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦

```bash
[root@server ~]# ls /proc/253184/fd/
0  10  12  14  16  18  2   21  23  25  27  29  30  32  34  36  38  4   41  43  45  5   59  60  62  64  66  68  7   71  73  75  77  79  80  82  84  9
1  11  13  15  17  19  20  22  24  26  28  3   31  33  35  37  39  40  42  44  46  53  6   61  63  65  67  69  70  72  74  76  78  8   81  83  85
```

å¦‚ä¸Šæ‰€æœ‰çš„æ•°å­—ç¼–å·ä¸º è¿›ç¨‹ å·²ç»æ‰“å¼€çš„ æ–‡ä»¶æè¿°ç¬¦çš„ç´¢å¼•ã€‚è¿™å…¶ä¸­ï¼Œæœ‰å‡ ä¸ªç‰¹æ®Šçš„æ–‡ä»¶æè¿°ç¬¦ï¼š

`0`: ä¸º(Standard Input) æ ‡å‡†è¾“å…¥ï¼Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œæ ‡å‡†è¾“å…¥æŒ‡å‘ `/dev/null`

`1`: ä¸º(Standard Output) æ ‡å‡†è¾“å‡ºï¼Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œæ ‡å‡†è¾“å…¥æŒ‡å‘ `/dev/null`

`2`: ä¸º(Standard Error) æ ‡å‡†é”™è¯¯ï¼Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œæ ‡å‡†è¾“å…¥æŒ‡å‘ `/dev/null`

å¦å¤–ï¼Œå¯é€šè¿‡ `ls -lh/proc/253184/fd/ ` æŸ¥çœ‹æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³çš„è¿›ç¨‹è°ƒç”¨ã€‚

```bash
#ls -lh /proc/253184/fd/
total 0
lr-x------ 1 oracle asmadmin 64 Nov  3 15:01 0 -> /dev/null
l-wx------ 1 oracle asmadmin 64 Nov  3 15:01 1 -> /dev/null
l-wx------ 1 oracle asmadmin 64 Nov  3 15:01 2 -> /dev/null
lr-x------ 1 oracle asmadmin 64 Nov  3 15:01 3 -> /dev/null
/opt/***/***/***/lib/libocrb19.so
lrwx------ 1 oracle asmadmin 64 Nov  3 15:01 4 -> anon_inode:[eventpoll]
lr-x------ 1 oracle asmadmin 64 Nov  3 15:01 41 -> /usr/lib64/ld-2.17.so
...
lrwx------ 1 oracle asmadmin 64 Nov  3 15:01 59 -> socket:[1898299425]
```

